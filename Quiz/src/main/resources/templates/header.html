<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
</head>
<body>

	<!--	menu fixed top-->
	<th:block th:fragment="menu_fix_top">
		<nav id="header" class="navbar navbar-fixed-top">
			<div id="header-container" class="container navbar-container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed"
						data-toggle="collapse" data-target="#navbar" aria-expanded="false"
						aria-controls="navbar">
						<span class="sr-only">Toggle navigation</span> <span
							class="icon-bar"></span> <span class="icon-bar"></span> <span
							class="icon-bar"></span>
					</button>
					<a id="brand" class="navbar-brand" href="javascript:void(0)"> <span
						id="open-slide" style="font-size: 30px; cursor: pointer"
						onclick="openNav()"><i class="fa fa-tachometer"></i> Quiz</span> <span
						id="close-slide" style="font-size: 30px; cursor: pointer"
						onclick="closeNav()"><i class="fa fa-window-close"></i>
							Quiz</span>
					</a>
				</div>
				<div id="navbar" class="collapse navbar-collapse">

					<ul class="nav navbar-nav navbar-right">
						<li><a th:href="@{/home}"><i class="fa fa-home icon-menu"></i>
								Trang chủ</a></li>
						<li class="dropdown"><a th:href="@{/friendrequest}"> <i
								class="fa fa-users icon-menu"></i> Lời mời kết bạn
						</a>
						</li>

						<li class="dropdown" ><a href="#" class="dropdown-toggle"  onclick="loadNotify()"
							data-toggle="dropdown"> <i class="fa fa-bell icon-menu"></i> Thông
								báo <span class="caret"></span>
						</a>
							<ul class="dropdown-menu notifity" id="notification">
<!-- 								<li> -->
<!-- 									<a href="#">  -->
<!-- 										<img class="contacts-list-img" src="https://bootdey.com/img/Content/user_1.jpg" />  -->
<!-- 										<span class="contacts-list-name"> Count Dracula  -->
<!-- 											<small class="contacts-list-date pull-right">2/28/2015</small> -->
<!-- 										</span> -->
<!-- 										<span class="contacts-list-msg contect-notifity">How have you been? I was...</span> -->
<!-- 									</a> -->
<!-- 								</li> -->
							</ul>
						</li>

						<li class="dropdown"><a href="#" class="dropdown-toggle"
							data-toggle="dropdown"> <img
								th:src="${session.account.avatar}!=null?@{${session.account.avatar}}:@{/upload/avatar/default_avatar.jpg}"
								alt="Ảnh đại diện" width="24px" class="img-circle" /> <span
								th:text="${session.account.name}"></span> <span class="caret"></span>
						</a>
							<ul class="dropdown-menu">
								<li><a th:href="@{/account/info}">Hồ sơ</a></li>
								<li><a href="#">Chỉnh sửa</a></li>
								<li class="divider"></li>
								<li><a href="#">Trợ giúp</a></li>
								<li><a th:href="@{/account/logout}">Đăng xuất</a></li>
							</ul></li>
					</ul>
				</div>
			</div>
		</nav>

		<!-- /load notification -->
		<script src="/js/sockjs.js"></script>
		<script src="/js/stomp.js"></script>
		<script src="/bootstrap-notify/bootstrap-notify.min.js"></script>
		<script type="text/javascript" th:inline="javascript">
			/*<![CDATA[*/

			var chat = new ChatRoom();
			chat.from = /*[[${session.account.idAcc}]]*/-1;
			// bien toan cuc
			function ChatRoom(from, to, location) {
				this.from = from;
				this.to = to;
				this.location=location;
			}
			var client = client = Stomp.over(new SockJS('/chat'));
			client.connect({}, function(frame) {
				client.subscribe('/topic/messages', function(message) {
					var data = JSON.parse(message.body);
					if (data.topic == "notification") {
						data.listIdAcc.forEach(function(entry) {
							if (entry == chat.from) {
								notify(data);
								return;
							}
						});

					}
				});
			});

			function notify(data) {
				$
						.notify(
								{
									icon : "glyphicon glyphicon-warning-sign",
									title : "Bạn có một thông báo mới từ",
									message : data.message,
									url : data.url,
									target : "_blank"
								},
								{
									element : "body",
									type : "info",
									allow_dismiss : true,
									newest_on_top : false,
									showProgressbar : false,
									placement : {
										from : "top",
										align : "right"
									},
									offset : 5,
									spacing : 10,
									z_index : 1031,
									delay : 5000,
									timer : 1000,
									url_target : "_blank",
									animate : {
										enter : "animated fadeInDown",
										exit : "animated fadeOutUp"
									},
									icon_type : "class",
									template : '<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert">'
											+ '<button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button>'
											+ '<span data-notify="icon"></span> '
											+ '<span data-notify="title">{1}</span> '
											+ '<span data-notify="message">{2}</span>'
											+ '<div class="progress" data-notify="progressbar">'
											+ '<div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>'
											+ "</div>"
											+ '<a href="{3}" target="{4}" data-notify="url"></a>'
											+ "</div>"
								});
			}

			function sendMes(topic, chat) {
				client.send("/app/chat/" + topic, {}, JSON.stringify({
					from : chat.from,
					text : chat.to,
					location: chat.location
				}));
			}
			function autoNotify(location) {
				var id_room = $("#id-room").val();
				chat.to = id_room;
				chat.location = location;
				sendMes("notification", chat);
			}
			function loadNotify(){
				 if(chat.from==-1){
					 return;
				 }
				 //alert("Load");
				 $.ajax({
					 url : "/load-notify",
					 type: "POST",
					 data:{from : chat.from},
					 success: function (response){
						 if(response){
							 $("#notification").html(response);
						 }
					 }
				 });
			}

			/*]]>*/
		</script>
		<!-- ./load notification -->

	</th:block>
</body>
</html>